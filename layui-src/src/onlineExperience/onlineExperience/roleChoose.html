<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@include file="/context/mytags.jsp"%>
<!DOCTYPE html>
<html lang="zh">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>角色选择</title>

  <link rel="stylesheet" type="text/css" href="plug-in/assets/css/common.css" />
  <link rel="stylesheet" type="text/css" href="plug-in/assets/css/normalize.css" />
  <link rel="stylesheet" href="plug-in/layui/css/layui.css" media="all" />
  <link rel="stylesheet" href="plug-in/iconfont/iconfont.css">

  <script type="text/javascript" src="plug-in/assets/js/jquery.min.js"></script>
  <script type="text/javascript" src="plug-in/layui/layui.js"></script>
  <script type="text/javascript" src="plug-in/assets/js/common.js"></script>
  <script type="text/javascript" src="plug-in/tools/curdtools_zh-cn.js"></script>
  <script type="text/javascript" src="plug-in/assets/js/polygonizr.min.js"></script>

  <!-- <link rel="stylesheet" type="text/css" href="../../assets/css/normalize.css">
  <link rel="stylesheet" type="text/css" href="../../assets/css/demo.css">
  <script src="../../layui.js"></script>
  <script src="../../assets/js/common.js"></script>
  <script type="text/javascript" src="../../jquery.min.js"></script>
  <script type="text/javascript" src="../../assets/js/polygonizr.min.js"></script> -->
  <style>
    h1 {

      font-size: 20px;
      margin: 80px 0 20px;
    }

    .role-box p,
    a,
    h3,
    h4,
    h5,
    span {
      font-size: 14px;
      /* color: #fff; */
    }

    .layui-row {
      margin: 40px auto 10px;
      width: 600px;
    }

    .col-box .col-img {
      margin: 0 30px;
      width: 100px;
      height: 100px;
    }

    .col-box .col-img img {
      width: 100%;
      height: 100%;
    }

    .col-box {
      /* display: inline-block; */
      /* border: 1px solid #000; */
      padding: 10px;
      background: rgba(241, 239, 239, 0.7);
      border-radius: 10px;
      float: left;
    }
    .col-box.col-box-right {
      float: right;
    }

    .col-box h3 {
      margin: 40px 0px 20px;
    }

    .col-box h3 strong {
      font-size: 20px;
      margin-right: 10px;
    }

    .col-box h5 {
      margin: 40px 0px 20px;
    }

    html,
    body {
      height: 100%;
      width: 100%;
      margin: 0;
      overflow: hidden;
    }

    #site-landing {
      position: relative;
      height: 100%;
      width: 100%;
      background-color: #30cfd0;
      background-image: linear-gradient(to top, #30cfd0 0%, #330867 100%);

    }

    #content-box {
      position: absolute;
      width: 100%;
      z-index: 10;

    }

    #content-box>h1,
    #content-box>p {
      color: #eee;
    }

    #content-box>p a.layui-color-blue {
      color: #000;
    }

    #content-box .layui-color-blue {
      color: #267dc5;
    }

    .role-box-explain {
      width: 600px;
      margin: 60px auto 10px;
      color: #eee;
      /* padding: 0 32%; */
      text-align: left;
    }

    .role-box-explain p {
      /* text-align: left; */
    }
  </style>

</head>

<body style="">
  <div class="role-box text-center" id="content-box">
    <h1>您可以使用以下账户登录在线体验系统</h1>
    <p>测试账户部分功能或操作受限，数据会定时重置</p>
    <div class="layui-row">
      <div class="layui-col-xs6">
        <div class="col-box" onclick="loginTester()">
          <div class="col-img">
            <img src="plug-in/assets/images/role-img01.png">
          </div>
          <h3><strong>许志宏</strong>检测工程师</h3>
          <h4>登录：<span id="tester"></span>次</h4>
          <h5><a href="javascript:loginTester();" class="layui-color-blue">使用TA的身份登录</a></h5>
        </div>
      </div>
      <div class="layui-col-xs6">
        <div class="col-box col-box-right" onclick="loginSuperuser()">
          <div class="col-img">
            <img src="plug-in/assets/images/role-img02.png">
          </div>
          <h3><strong>钱珮珊</strong>超级用户</h3>
          <h4>登录：<span id="superuser"></span>次</h4>
          <h5><a href="javascript:loginSuperuser();" class="layui-color-blue">使用TA的身份登录</a></h5>
        </div>
      </div>
      <div class="layui-col-xs12">
        <div class="role-box-explain">
          <h5>体验说明</h5>
          <p><i class="iconfont icon-star"></i>检测工程师账号只能体验试验数据填写功能，超级用户账号可体验完整检测流程</p>
          <p><i class="iconfont icon-star"></i>体验系统内置公路综合甲级资质参数</p>
          <p><i class="iconfont icon-star"></i>更多资质参数及功能体验请联系重庆海特科技</p>
        </div>
      </div>
    </div>
    <!-- <div class="role-box-explain">
      <h5>体验说明</h5>
      <p><i class="iconfont icon-star"></i>检测工程师账号只能体验试验数据填写功能，超级用户账号可体验完整检测流程</p>
      <p><i class="iconfont icon-star"></i>体验系统内置公路综合甲级资质参数</p>
      <p><i class="iconfont icon-star"></i>更多资质参数及功能体验请联系重庆海特科技</p>
    </div> -->
    <p><a href="#" onclick="goHitekInfoFun()" class="layui-color-blue">联系我们</a>，获取专属账号！</p>
    <form style="display: none;" id="loinForm" class="form-horizontal" check="loginController.do?checkuser" role="form"
      action="loginController.do?login" method="post">
      <input type="text" name="userName" class="form-control" placeholder="请输入用户名" id="userName" value=""
        style="display: none;" />
      <input type="password" name="password" class="form-control" placeholder="请输入密码" id="password" value=""
        style="display: none;" />
      <input type="text" name="companyId" class="form-control" placeholder="请输入公司名称" id="companyId" value=""
        style="display: none;" />
      <input type="hidden" name="targetUrl" class="form-control" placeholder="目标菜单地址" id="targetUrl" value=""
        style="display: none;" />
    </form>
  </div>
  <div id="site-landing"><canvas width="848" height="758" style="position: absolute;"></canvas></div>


  <script type="text/javascript">
    $('#site-landing').polygonizr();
  </script>
  <script type="text/javascript">
    $(function () {
      layui.use(['laydate', 'layer'], function () {
        var laydate = layui.laydate;
        var layer = layui.layer;
      });

    })
    $(function () {
      getLoginTimes('onlineExperienceController.do?getSuperuserLoginTimes', 'superuser');
      getLoginTimes('onlineExperienceController.do?getTesterLoginTimes', 'tester');
      var targetUrl = GetQueryString("targetUrl");
      $("#targetUrl").val(targetUrl);
    })
    function ajaxRequestSync2(url, dataJson) {
      var returnValue;
      $.ajax({    // 发起同步请求
        url: url
        , async: false
        , data: dataJson
        , dataType: 'json'
        , type: 'post'
        , beforeSend: function () {
        }
        , success: function (res) {
          returnValue = res;
        }
      });
      return returnValue;
    }
    function getLoginTimes(url, username) {
      var res = ajaxRequestSync2(url, {});
      if (res.success) {
        $("#" + username).text(res.obj);
      } else {
        layer.msg('系统维护中，请联系管理员...', { icon: 5 });
      }
    }
    // 联系我们
    function goHitekInfoFun() {
      layerOpenFun('onlineExperienceController.do?goHitekInfo', '关于我们', ['550px', '404px'], [], '', 'noOpenCallback');
    }
    function loginTester() {
      $("#userName").val("tester");
      $("#password").val("123456");
      $("#companyId").val("tester");
      checkUser();
    }

    function loginSuperuser() {
      $("#userName").val("superuser");
      $("#password").val("111111");
      $("#companyId").val("superuser");
      checkUser();
    }

    function checkUser() {
      //存储表单数据
      storeTool.storeFunc('login-data', ['value', 'checked'], ['#userName', '#password', '#companyId', '#randCode', '#on_off', '#langCode']);
      newLogin();
    }

    function newLogin() {
      var actionurl = $('form').attr('action');//提交路径
      var checkurl = $('form').attr('check');//验证路径
      var formData = new Object();
      var data = $(":input").each(function () {
        formData[this.name] = $("#" + this.name).val();
      });
      formData['orgId'] = "";
      //语言
      formData['langCode'] = "zh-cn";
      $.ajax({
        async: false,
        cache: false,
        type: 'POST',
        url: checkurl,// 请求的action路径
        data: formData,
        error: function () {// 请求失败处理函数
        },
        success: function (data) {
          var d = $.parseJSON(data);
          if (d.success) {
            if (d.attributes.orgNum > 1) {
              //用户拥有多个部门，需选择部门进行登录
              var title, okButton;
              if ($("#langCode").val() == 'en') {
                title = "Please select Org";
                okButton = "Ok";
              } else {
                title = "请选择组织机构";
                okButton = "确定";
              }
              $.dialog({
                id: 'LHG1976D',
                title: title,
                max: false,
                min: false,
                drag: false,
                resize: false,
                content: 'url:userController.do?userOrgSelect&userId=' + d.attributes.user.id + '&companyId=' + formData['companyId'],
                lock: true,
                button: [{
                  name: okButton,
                  focus: true,
                  callback: function () {
                    iframe = this.iframe.contentWindow;
                    var orgId = $('#orgId', iframe.document).val();

                    formData['orgId'] = orgId ? orgId : "";
                    $.ajax({
                      async: false,
                      cache: false,
                      type: 'POST',
                      url: 'loginController.do?changeDefaultOrg',// 请求的action路径
                      data: formData,
                      error: function () {// 请求失败处理函数
                      },
                      success: function (data) {
                        console.log('data287', data)
                        console.log('window.location.href', window.location.href)
                        window.location.href = actionurl;
                        console.log('actionurl', actionurl)
                      }
                    });

                    this.close();
                    return false;
                  }
                }],
                close: function () {
                  setTimeout("window.location.href='" + actionurl + "'", 10);
                }
              });
            } else {
              window.location.href = actionurl;
            }
          } else {
            layer.msg(d.msg, { icon: 5 });
          }
        }
      });
    }

  </script>

</body>

</html>